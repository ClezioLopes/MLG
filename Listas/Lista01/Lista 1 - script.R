### Exercício 7 ####

# dados
y <- matrix(c(2.3,1.8,1.5,1.3,1.2), 5, 1)
x <- matrix(c(2,4,6,9,10), 5, 1)


##################################################################
x_matrix <- matrix(c(1,1,1,1,1,
                     2,4,6,9,10), 5, 2)

##################################################################
eta_0 <- matrix(c(0.1890,0.3086,0.4444,0.5917,0.6944), 5, 1)
z_0 <- eta_0
W_0 <- diag(c(3.0417,1.458,0.8437,0.5492,0.432), 5)

beta_1 <- solve( t(x_matrix) %*% W_0 %*% x_matrix ) %*% 
          t(x_matrix) %*% W_0 %*% z_0

##################################################################
eta_1 <- 0.06727188 + 0.06094553*x
mu_1 <- eta_1^(-1/2)
G_1 <- diag(as.vector(-2/mu_1^3), 5, 5)
z_1 <- eta_1 + G_1 %*% (y - mu_1)

W_1 <- diag(as.vector(mu_1^3/4), 5, 5)

beta_2 <- solve( t(x_matrix) %*% W_1 %*% x_matrix ) %*% 
  t(x_matrix) %*% W_1 %*% z_1

##################################################################
# critério de parada
sum((beta_2 - beta_1)/beta_1)^2



##################################################################
# usando a função glm para comparar os resultados
fit <- glm(y~x,family = inverse.gaussian(link = "1/mu^2"))
summary(fit)

##################################################################
mu_i <- (0.06714032 + 0.06101485*x)^(-1/2)

sum((y-mu_i)^2/(2*y*mu_i^2))

sum((y - mu_i)^2/mu_i^3)

### Exercício 7 ####

# dados
y <- matrix(c(2.3,1.8,1.5,1.3,1.2), 5, 1)
x <- matrix(c(2,4,6,9,10), 5, 1)

##################################################################
x_matrix <- matrix(c(1,1,1,1,1,
                     2,4,6,9,10), 5, 2)

##################################################################
eta_0 <- matrix(c(0.1890,0.3086,0.4444,0.5917,0.6944), 5, 1)
z_0 <- eta_0
W_0 <- diag(c(y^3), 5)

beta_1 <- solve( t(x_matrix) %*% W_0 %*% x_matrix ) %*% 
  t(x_matrix) %*% W_0 %*% z_0

##################################################################
eta_1 <- 0.06727222 + 0.06094542*x
mu_1 <- eta_1^(-1/2)
G_1 <- diag(as.vector(-2/mu_1^3), 5, 5)
z_1 <- eta_1 + G_1 %*% (y - mu_1)

W_1 <- diag(as.vector(mu_1^3/4), 5, 5)

beta_2 <- solve( t(x_matrix) %*% W_1 %*% x_matrix ) %*% 
  t(x_matrix) %*% W_1 %*% z_1

##################################################################
# critério de parada
sum((beta_2 - beta_1)/beta_1)^2



##################################################################
# usando a função glm para comparar os resultados
fit <- glm(y~x,family = inverse.gaussian(link = "1/mu^2"))
summary(fit)

##################################################################
mu_i <- (0.06714032 + 0.06101485*x)^(-1/2)

sum((y-mu_i)^2/(2*y*mu_i^2))

sum((y - mu_i)^2/mu_i^3)

